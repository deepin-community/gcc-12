From b410800609c3323018e5fc6f8752137a61e7caaa Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Fri, 3 Mar 2023 16:32:41 +0800
Subject: [PATCH 037/301] LoongArch: testsuite: Disable stack protector for
 some tests

Stack protector will affect stack layout and break the expectation of
these tests, causing test failures if GCC is configured with
--enable-default-ssp.

gcc/testsuite/ChangeLog:

	* gcc.target/loongarch/prolog-opt.c (dg-options): Add
	-fno-stack-protector.
	* gcc.target/loongarch/stack-check-cfa-1.c (dg-options):
	Likewise.
	* gcc.target/loongarch/stack-check-cfa-2.c (dg-options):
	Likewise.

Signed-off-by: Peng Fan <fanpeng@loongson.cn>
Signed-off-by: ticat_fp <fanpeng@loongson.cn>
---
 src/gcc/testsuite/gcc.target/loongarch/prolog-opt.c        | 2 +-
 src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-1.c | 2 +-
 src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-2.c | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/gcc/testsuite/gcc.target/loongarch/prolog-opt.c b/src/gcc/testsuite/gcc.target/loongarch/prolog-opt.c
index 0470a1f1e..e6a642633 100644
--- a/src/gcc/testsuite/gcc.target/loongarch/prolog-opt.c
+++ b/src/gcc/testsuite/gcc.target/loongarch/prolog-opt.c
@@ -1,7 +1,7 @@
 /* Test that LoongArch backend stack drop operation optimized.  */
 
 /* { dg-do compile } */
-/* { dg-options "-O2 -mabi=lp64d" } */
+/* { dg-options "-O2 -mabi=lp64d -fno-stack-protector" } */
 /* { dg-final { scan-assembler "addi.d\t\\\$r3,\\\$r3,-16" } } */
 
 extern int printf (char *, ...);
diff --git a/src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-1.c b/src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-1.c
index f0c6877fc..3533fe7b6 100644
--- a/src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-1.c
+++ b/src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-1.c
@@ -1,5 +1,5 @@
 /* { dg-do compile } */
-/* { dg-options "-O2 -fstack-clash-protection --param stack-clash-protection-guard-size=16 -funwind-tables" } */
+/* { dg-options "-O2 -fstack-clash-protection --param stack-clash-protection-guard-size=16 -funwind-tables -fno-stack-protector" } */
 /* { dg-require-effective-target supports_stack_clash_protection } */
 /* { dg-skip-if "" { *-*-* } { "-fstack-check" } { "" } } */
 
diff --git a/src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-2.c b/src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-2.c
index c6e07bc56..e5e711105 100644
--- a/src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-2.c
+++ b/src/gcc/testsuite/gcc.target/loongarch/stack-check-cfa-2.c
@@ -1,5 +1,5 @@
 /* { dg-do compile } */
-/* { dg-options "-O2 -fstack-clash-protection --param stack-clash-protection-guard-size=16 -funwind-tables" } */
+/* { dg-options "-O2 -fstack-clash-protection --param stack-clash-protection-guard-size=16 -funwind-tables -fno-stack-protector" } */
 /* { dg-require-effective-target supports_stack_clash_protection } */
 /* { dg-skip-if "" { *-*-* } { "-fstack-check" } { "" } } */
 
-- 
2.45.2

